# 当前待解决的问题

## 已完成的功能

### 1. tsconfig 配置修复 ✅
- 修复了 `tsconfig.node.json` 中缺少 `composite: true` 和 emit 配置的问题
- 现在 TypeScript 项目引用可以正常工作

### 2. 画布右键菜单 ✅
- 添加了 `ContextMenu.svelte` 组件
- 画布右键点击可弹出菜单
- 在节点上右键:编辑节点、删除节点
- 在空白区域右键:添加节点、适应视图、重置缩放

### 3. 画布编辑时代码区遮盖 ✅
- 编辑画布时自动遮盖代码区域,显示"正在编辑画布..."提示
- 编辑完成后延迟 1.5 秒自动恢复代码区显示
- 支持通过 `syncDelay` 参数自定义延迟时间

### 4. 右键菜单二级菜单支持 ✅
- 添加了二级菜单(子菜单)支持
- "添加节点" → 展开显示不同节点形状(矩形、圆角矩形、胶囊形、圆形、菱形、六边形)
- 子菜单自动调整位置避免超出视口

### 5. 自定义节点编辑对话框 ✅
- 创建了 `NodeEditDialog.svelte` 组件替代浏览器原生 `prompt()` 对话框
- 支持编辑节点文本
- 支持选择节点形状(可视化形状选择器)
- 美观的模态对话框设计,支持 Enter 确认和 Escape 取消

### 6. 边的可视化添加功能 ✅
- 创建了 `EdgeAddDialog.svelte` 组件
- 在节点上右键可选择"添加连接"
- 支持选择目标节点
- 支持设置连接文本标签
- 支持选择线条类型(实线、粗线、虚线)
- 支持选择箭头类型(箭头、圆形、叉形、无)
- 实时预览连接效果

### 7. 撤销/重做功能 ✅
- 实现了 Undo/Redo 栈(最多保存 50 步历史)
- 支持键盘快捷键 (Ctrl+Z / Ctrl+Y 或 Cmd+Z / Cmd+Shift+Z)
- 在工具栏添加了撤销/重做按钮
- 按钮根据状态自动启用/禁用

### 8. 节点多选和批量操作 ✅
- 支持 Ctrl/Cmd+Click 多选节点
- 支持 Shift+拖拽 框选多个节点
- 支持 Ctrl/Cmd+A 全选节点
- 支持批量删除(Delete/Backspace 删除所有选中节点)
- 显示多选指示器("已选中 N 个节点")
- 框选时显示可视化选择框

### 9. 节点智能定位 ✅
- 新添加的节点会放置在右键点击的位置
- 添加节点后自动选中新节点

### 10. 测试用例实现 ✅
- 实现了 `FlowchartModel.test.ts` 的 20 个测试用例
- 实现了 `MermaidParser.test.ts` 的 20 个测试用例
- 实现了 `MermaidSerializer.test.ts` 的 24 个测试用例
- 实现了 `SyncEngine.test.ts` 的 23 个测试用例
- 总计 87 个测试用例全部通过

### 11. Mermaid 序列化语法修复 ✅
- 修复了节点文本中特殊字符的转义问题,使用 Mermaid 的 markdown string 语法 (`` "`...`" ``)
- 修复了边标签语法错误(从 `--|text|>` 改为正确的 `-->|text|`)
- 修复了子图标题的特殊字符处理
- 添加了对反引号、括号、方括号等特殊字符的正确转义

---

## 待解决的问题

### 1. 拖拽式连线(高级功能)
**问题描述**:当前添加边需要通过对话框选择,拖拽式连线会更直观.

**建议改进**:
- 从节点边缘拖拽到另一个节点创建边
- 拖拽时显示临时连线
- 支持取消拖拽

### 2. 节点位置避免重叠
**问题描述**:当在已有节点附近添加新节点时可能会重叠.

**建议改进**:
- 智能检测周围节点位置
- 自动调整新节点位置避免重叠
- 或提供自动布局功能重新排列所有节点

---

## 技术债务

### 1. 构建警告
- 存在一些 TypeScript 类型声明相关的构建警告
- 不影响功能但应该清理

### 2. 节点位置持久化
- 节点拖拽位置仅存储在内存中
- 需要考虑位置信息的持久化存储方案(如 localStorage 或导出/导入功能)
