# FR-03: æ–°å½¢çŠ¶æ¸²æŸ“

> ä¼˜å…ˆçº§: P1 | çŠ¶æ€: âœ… å®Œæˆ

## ğŸ“‹ æ¦‚è¿°

ä¸º FR-01 è§£æçš„ 30+ æ–°å½¢çŠ¶ç±»å‹å®ç° SVG æ¸²æŸ“ã€‚

å‚è€ƒ: [Mermaid Flowchart - Node Shapes](https://mermaid.js.org/syntax/flowchart.html#node-shapes)

---

## ğŸ¯ éœ€æ±‚

### 3.1 æ¸²æŸ“ä¼˜å…ˆçº§

æŒ‰ä½¿ç”¨é¢‘ç‡åˆ†æ‰¹å®ç°:

**ç¬¬ä¸€æ‰¹ (å¸¸ç”¨):**
- `doc` / `document` - æ–‡æ¡£å½¢çŠ¶ (åº•éƒ¨æ³¢æµª)
- `card` / `notched-rectangle` - å¡ç‰‡/ç¼ºè§’çŸ©å½¢
- `delay` / `half-rounded-rect` - å»¶è¿Ÿ/åŠåœ†è§’
- `hourglass` / `collate` - æ²™æ¼/æ•´ç†

**ç¬¬äºŒæ‰¹ (ä¸­ç­‰é¢‘ç‡):**
- `bolt` / `lightning` - é—ªç”µ
- `triangle` / `tri` - ä¸‰è§’å½¢
- `window-pane` / `win-pane` - çª—æ ¼
- `divided-rect` / `div-rect` - åˆ†éš”çŸ©å½¢
- `lined-rect` / `lin-rect` - å¸¦çº¿çŸ©å½¢

**ç¬¬ä¸‰æ‰¹ (å…¶ä»–):**
- `fork` - åˆ†å‰/åˆå¹¶
- `crossed-circle` - å‰åœˆ
- `sm-circ` / `small-circle` - å°åœ†
- å…¶ä»– shapes.ts ä¸­å®šä¹‰çš„å½¢çŠ¶

### 3.2 SVG è·¯å¾„å®ç°

æ¯ä¸ªå½¢çŠ¶éœ€è¦:
1. SVG path æ•°æ®ç”Ÿæˆå‡½æ•°
2. æ”¯æŒåŠ¨æ€å®½é«˜
3. ä¸ç°æœ‰æ¸²æŸ“ç®¡çº¿é›†æˆ

---

## ğŸ”§ å®ç°

### ShapeRenderer æ‰©å±•

**æ–‡ä»¶:** `src/canvas/shapes/ShapeRenderer.ts`

```typescript
// æ–°å½¢çŠ¶æ¸²æŸ“æ˜ å°„
const NEW_SHAPE_RENDERERS: Record<string, ShapeRenderFn> = {
  doc: renderDocument,
  card: renderCard,
  delay: renderDelay,
  hourglass: renderHourglass,
  bolt: renderBolt,
  triangle: renderTriangle,
  // ...
};

// æ–‡æ¡£å½¢çŠ¶ (åº•éƒ¨æ³¢æµª)
function renderDocument(x: number, y: number, w: number, h: number): string {
  const waveHeight = h * 0.1;
  return `
    M ${x} ${y}
    L ${x + w} ${y}
    L ${x + w} ${y + h - waveHeight}
    Q ${x + w * 0.75} ${y + h} ${x + w / 2} ${y + h - waveHeight}
    Q ${x + w * 0.25} ${y + h - waveHeight * 2} ${x} ${y + h - waveHeight}
    Z
  `;
}

// å¡ç‰‡/ç¼ºè§’çŸ©å½¢
function renderCard(x: number, y: number, w: number, h: number): string {
  const notch = Math.min(w, h) * 0.15;
  return `
    M ${x + notch} ${y}
    L ${x + w} ${y}
    L ${x + w} ${y + h}
    L ${x} ${y + h}
    L ${x} ${y + notch}
    Z
  `;
}
```

### å‚è€ƒ Mermaid æºç 

**æ–‡ä»¶:** `docs/source_ref/mermaid/packages/mermaid/src/rendering-util/rendering-elements/shapes/`

Mermaid çš„å½¢çŠ¶å®ç°ä½äºä¸Šè¿°ç›®å½•ï¼Œæ¯ä¸ªå½¢çŠ¶ä¸€ä¸ªæ–‡ä»¶ã€‚

---

## âœ… éªŒæ”¶æ ‡å‡†

### æ¸²æŸ“æµ‹è¯•

```typescript
describe('æ–°å½¢çŠ¶æ¸²æŸ“', () => {
  it('æ¸²æŸ“ document å½¢çŠ¶', () => {
    const svg = renderShape('doc', 100, 100, 120, 80);
    expect(svg).toContain('Q'); // åŒ…å«äºŒæ¬¡æ›²çº¿ (æ³¢æµª)
  });

  it('æ¸²æŸ“ card å½¢çŠ¶', () => {
    const svg = renderShape('card', 100, 100, 120, 80);
    // éªŒè¯ç¼ºè§’è·¯å¾„
  });
});
```

### E2E æµ‹è¯•

```typescript
// e2e/shapes.spec.ts
test('æ–°å½¢çŠ¶æ­£ç¡®æ¸²æŸ“', async ({ page }) => {
  // è¾“å…¥ Mermaid ä»£ç 
  await page.fill('[data-testid="code-input"]', `
    flowchart TD
      A@{ shape: doc, label: "æ–‡æ¡£" }
  `);

  // éªŒè¯ SVG å­˜åœ¨
  await expect(page.locator('svg path')).toBeVisible();
});
```

---

## ğŸ“Š å·¥ä½œé‡ä¼°ç®—

| å½¢çŠ¶æ•°é‡ | é¢„è®¡æ—¶é—´ |
|----------|----------|
| ç¬¬ä¸€æ‰¹ (4ä¸ª) | 2-3 å¤© |
| ç¬¬äºŒæ‰¹ (5ä¸ª) | 2-3 å¤© |
| ç¬¬ä¸‰æ‰¹ (20+) | 5-7 å¤© |

---

## ğŸ”— ä¾èµ–

- å‰ç½®: FR-01 (æ–°å½¢çŠ¶è¯­æ³•è§£æ)
- è¢«ä¾èµ–: FR-10 (å½¢çŠ¶é€‰æ‹©å™¨ä¼˜åŒ–)
