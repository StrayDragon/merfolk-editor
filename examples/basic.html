<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Merfolk Editor - Basic Example</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f0f2f5;
    }

    #editor {
      width: 100%;
      height: 80vh;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      background: white;
    }

    .controls {
      margin: 20px 0;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .controls h2 {
      margin: 0 0 16px 0;
      font-size: 18px;
    }

    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    button {
      padding: 8px 16px;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      background: #f6f8fa;
      color: #24292f;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.15s ease;
    }

    button:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }

    button:active {
      background: #e5e7eb;
      transform: translateY(1px);
    }

    .code-output {
      margin: 20px 0;
      padding: 20px;
      background: #f6f8fa;
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="controls">
    <h2>API Controls</h2>
    <div class="button-group">
      <button onclick="getCode()">Get Code</button>
      <button onclick="addNode()">Add Node</button>
      <button onclick="addEdge()">Add Edge</button>
      <button onclick="zoomIn()">Zoom In</button>
      <button onclick="zoomOut()">Zoom Out</button>
      <button onclick="fitToView()">Fit to View</button>
      <button onclick="toggleEdgeMode()">Toggle Edge Mode</button>
      <button onclick="toggleCodePanel()">Toggle Code Panel</button>
    </div>
    <div id="codeOutput" class="code-output" style="display: none;"></div>
  </div>

  <div id="editor"></div>

  <!-- Module scripts for ES modules -->
  <script type="importmap">
  {
    "imports": {
      "svelte": "/node_modules/svelte/index.mjs",
      "mermaid": "/node_modules/mermaid/dist/mermaid.esm.min.mjs",
      "d3": "/node_modules/d3/dist/d3.min.mjs"
    }
  }
  </script>

  <script type="module">
    import MerfolkEditor from '../src/lib/index.js';

    // Initial Mermaid code
    const initialCode = `flowchart TD
    A[Start] --> B{Decision}
    B -->|Yes| C[Process 1]
    B -->|No| D[Process 2]
    C --> E[End]
    D --> E`;

    // Create editor instance
    const editor = new MerfolkEditor(document.getElementById('editor'), {
      initialCode,
      onCodeChange: (code) => {
        console.log('Code changed:', code);
      }
    });

    // Make editor globally available for demo buttons
    window.editor = editor;

    // Demo functions
    window.getCode = function() {
      const code = editor.getCode();
      const output = document.getElementById('codeOutput');
      output.textContent = code;
      output.style.display = 'block';
    };

    window.addNode = function() {
      const nodeId = `node${Date.now()}`;
      editor.addNode({
        id: nodeId,
        text: 'New Node',
        shape: 'rect',
        cssClasses: []
      });
      // Position it randomly
      const x = Math.random() * 400 + 100;
      const y = Math.random() * 300 + 100;
      editor.setNodePosition(nodeId, x, y);
    };

    window.addEdge = function() {
      // This requires knowing node IDs
      editor.addEdge({
        id: `edge${Date.now()}`,
        source: 'A',
        target: 'D',
        stroke: 'normal',
        arrowStart: 'none',
        arrowEnd: 'arrow',
        text: 'New Edge'
      });
    };

    window.zoomIn = function() {
      editor.zoomIn();
    };

    window.zoomOut = function() {
      editor.zoomOut();
    };

    window.fitToView = function() {
      editor.fitToView();
    };

    window.toggleEdgeMode = function() {
      editor.toggleEdgeCreationMode();
    };

    window.toggleCodePanel = function() {
      const codePanel = document.querySelector('#editor .code-container');
      if (codePanel) {
        codePanel.style.display = codePanel.style.display === 'none' ? 'flex' : 'none';
      }
    };
  </script>
</body>
</html>